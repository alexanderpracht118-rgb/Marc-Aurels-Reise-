<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbis Terrarum - Die Antike Welt</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Google Fonts: Cinzel (Römisch) & Lato (Lesbar) -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        antiquity: {
                            base: '#fdfbf7',     /* Helles Pergament */
                            paper: '#f0e6d2',    /* Dunkleres Pergament */
                            gold: '#c5a059',     /* Goldakzente (Marc Aurel) */
                            copper: '#4d8076',   /* Kupfer/Patina (Plinius) */
                            red: '#8a2c2c',      /* Römisches Rot */
                            dark: '#2c241b',     /* Dunkle Schrift */
                        }
                    },
                    fontFamily: {
                        heading: ['Cinzel', 'serif'],
                        body: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f0e6d2; }
        ::-webkit-scrollbar-thumb { background: #c5a059; border-radius: 4px; }
        
        /* Popup Styling */
        .leaflet-popup-content-wrapper {
            background: #fdfbf7;
            border: 2px solid #c5a059;
            border-radius: 4px;
            font-family: 'Lato', sans-serif;
            box-shadow: 4px 4px 0px rgba(44, 36, 27, 0.2);
            padding: 0;
        }
        .leaflet-popup-content { margin: 12px; }
        .leaflet-popup-tip { background: #c5a059; }
        .leaflet-container a.leaflet-popup-close-button { color: #8a2c2c; }

        /* Marker Styles */
        .custom-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            font-size: 12px;
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }
        .custom-marker:hover {
            transform: scale(1.2);
        }

        /* Selection */
        ::selection { background: #8a2c2c; color: #fdfbf7; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-antiquity-base text-antiquity-dark font-body min-h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-antiquity-dark text-antiquity-base shadow-lg border-b-4 border-antiquity-gold z-20 relative transition-colors duration-500" id="main-header">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            
            <!-- Logo -->
            <div class="flex items-center space-x-3">
                <i data-lucide="column" class="text-antiquity-gold h-8 w-8"></i>
                <div>
                    <h1 class="font-heading text-2xl tracking-widest font-bold text-antiquity-gold">ORBIS TERRARUM</h1>
                    <p class="text-xs text-gray-400 tracking-wider uppercase">Reisen der Kaiserzeit</p>
                </div>
            </div>

            <!-- Route Switcher Navigation -->
            <nav class="flex bg-antiquity-paper/10 rounded-lg p-1 border border-antiquity-gold/30">
                <button onclick="switchRoute('marc')" id="btn-marc" class="px-6 py-2 rounded font-heading text-sm tracking-widest transition-all bg-antiquity-gold text-antiquity-dark shadow-lg">
                    ITER MARCI
                </button>
                <button onclick="switchRoute('plinius')" id="btn-plinius" class="px-6 py-2 rounded font-heading text-sm tracking-widest transition-all text-gray-400 hover:text-antiquity-copper">
                    ITER PLINII
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col md:flex-row h-[calc(100vh-80px)]">
        
        <!-- Sidebar / Details Panel -->
        <aside class="w-full md:w-1/3 lg:w-[400px] bg-antiquity-paper border-r border-antiquity-gold/30 flex flex-col shadow-2xl z-10 relative">
            
            <!-- Panel Header -->
            <div class="p-6 border-b border-antiquity-gold/20 bg-antiquity-base">
                <h2 id="panel-title" class="font-heading text-2xl text-antiquity-gold mb-1">Willkommen</h2>
                <div class="flex items-center space-x-2 text-antiquity-red text-sm font-bold uppercase tracking-wider opacity-80">
                    <i data-lucide="map-pin" class="w-4 h-4"></i>
                    <span id="loc-region">Wähle eine Route</span>
                </div>
            </div>
            
            <!-- Panel Content -->
            <div class="flex-grow overflow-y-auto p-6 space-y-6 relative">
                
                <!-- Dynamic Content Area -->
                <div id="location-details" class="hidden animate-fade-in">
                    
                    <!-- Image Placeholder (using Unsplash source based on keywords) -->
                    <div class="relative w-full h-48 mb-6 overflow-hidden rounded border-2 border-antiquity-gold shadow-md group">
                         <img id="loc-img" src="" alt="Location" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110">
                         <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                         <div class="absolute bottom-3 left-3 text-white font-heading text-sm" id="loc-date">Datum</div>
                    </div>
                    
                    <!-- Main Text -->
                    <div class="prose prose-sm prose-stone">
                        <p id="loc-text" class="text-base leading-relaxed text-antiquity-dark">
                            <!-- Description goes here -->
                        </p>
                    </div>

                    <!-- Quote Block -->
                    <div class="mt-8 relative pl-6 border-l-4 border-antiquity-gold/50 italic text-antiquity-dark/80 bg-antiquity-base/50 p-4 rounded-r">
                        <i data-lucide="quote" class="absolute -top-3 left-2 w-6 h-6 text-antiquity-gold fill-current opacity-20"></i>
                        <p id="loc-quote" class="font-serif text-lg">...</p>
                        <p id="loc-source" class="text-xs text-right mt-2 font-bold uppercase text-antiquity-red tracking-wider">Quelle</p>
                    </div>

                </div>

                <!-- Empty State -->
                <div id="empty-state" class="text-center opacity-60 mt-20 flex flex-col items-center">
                    <div class="w-20 h-20 rounded-full bg-antiquity-gold/10 flex items-center justify-center mb-4 border border-antiquity-gold/30">
                        <i data-lucide="compass" class="w-10 h-10 text-antiquity-gold"></i>
                    </div>
                    <p class="font-heading text-lg text-antiquity-dark">Wähle eine Station<br>auf der Karte</p>
                    <p class="text-sm mt-2 max-w-xs mx-auto">Klicke auf die nummerierten Marker, um Details zur Reise zu erfahren.</p>
                </div>
            </div>

            <!-- Navigation Footer in Sidebar -->
            <div class="p-4 bg-antiquity-base border-t border-antiquity-gold/20 flex justify-between items-center text-xs text-gray-400">
                <span>Historia Augusta & Cassius Dio</span>
                <span>Plinius Epistulae</span>
            </div>
        </aside>

        <!-- Map Container -->
        <div class="flex-grow relative bg-[#e5e0d8]">
            <div id="map" class="w-full h-full z-0"></div>
            <!-- Vignette Overlay for antique feel -->
            <div class="pointer-events-none absolute inset-0 z-[400] bg-[radial-gradient(circle_at_center,transparent_20%,rgba(44,36,27,0.15)_100%)]"></div>
        </div>

    </main>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // --- 1. DATASETS ---
        
        const MARC_AUREL_DATA = [
            { id: 1, name: "Sirmium / Donau", lat: 44.97, lng: 19.61, region: "Pannonien", date: "175 n. Chr.", desc: "Marc Aurel plant, das Markomannen- und Sarmatenland endgültig zur Provinz zu machen. Doch die Nachricht vom Usurpationsversuch des Avidius Cassius im Osten zwingt ihn zum Abbruch.", quote: "So gab denn Marcus den Sarmaten- und Markomannenkrieg auf und zog gegen Cassius.", source: "Historia Augusta, MA 25,1" },
            { id: 2, name: "Syrien (Marsch)", lat: 34.80, lng: 38.99, region: "Syria", date: "Ende 175 n. Chr.", desc: "Der Kaiser reist mit seiner Frau Faustina und Sohn Commodus in den Osten. Noch bevor sie eintreffen, wird der Usurpator Cassius von einem eigenen Centurio getötet.", quote: "Er hatte die Absicht [...] reiste er mit seinem Vater nach Syrien und Ägypten.", source: "Historia Augusta, C 2,3" },
            { id: 3, name: "Antiochia", lat: 36.20, lng: 36.16, region: "Syria", date: "176 n. Chr.", desc: "Antiochia war das Zentrum des Aufstands. Anfangs mied Marc Aurel die Stadt und verbot öffentliche Schauspiele. Später besuchte er sie doch und zeigte Milde.", quote: "Hinterher hat er doch noch Antiochia besucht. [...] Er verzieh auch den Städten.", source: "HA, MA 25,8-26" },
            { id: 4, name: "Alexandria", lat: 31.20, lng: 29.91, region: "Aegyptus", date: "176 n. Chr.", desc: "In Alexandria tritt der Kaiser als 'Bürger und Philosoph' auf. Er besucht Tempel und Lehrstätten und lässt die belastende Korrespondenz des Cassius verbrennen.", quote: "Bei den Ägyptern gab er sich [...] als Bürger und Philosoph.", source: "HA, MA 26,3" },
            { id: 5, name: "Faustinopolis", lat: 37.35, lng: 34.90, region: "Cappadocia", date: "176 n. Chr.", desc: "Auf der Rückreise stirbt Kaiserin Faustina in einem Dorf in Kappadokien. Marc Aurel trauert tief und benennt den Ort in 'Faustinopolis' um.", quote: "Zur nämlichen Zeit schied auch Faustina aus dem Leben.", source: "Cassius Dio 72, 29,1" },
            { id: 6, name: "Athen", lat: 37.98, lng: 23.72, region: "Achaea", date: "Herbst 176 n. Chr.", desc: "In Athen lässt sich Marc Aurel in die Eleusinischen Mysterien einweihen, um seine rituelle Reinheit zu beweisen.", quote: "Nach der Regelung der Angelegenheiten im Osten hielt er sich in Athen auf.", source: "HA, MA 27,1" },
            { id: 7, name: "Brundisium", lat: 40.63, lng: 17.94, region: "Italia", date: "176 n. Chr.", desc: "Bei der Landung in Italien legt er sofort den Feldherrenmantel ab und legt die Toga an. Auch seine Soldaten müssen Zivil tragen.", quote: "Über Brundisium in Italien eingetroffen, legte er [...] selbst die Toga an.", source: "HA, MA 27,3" },
            { id: 8, name: "Rom", lat: 41.90, lng: 12.49, region: "Italia", date: "Dez. 176 n. Chr.", desc: "Marc Aurel feiert einen Triumphzug über die Germanen und Sarmaten. Commodus wird zum Mitregenten ernannt.", quote: "In Rom zog er in Triumph ein.", source: "HA, MA 27,4" },
            { id: 9, name: "Lavinium", lat: 41.66, lng: 12.48, region: "Latium", date: "177 n. Chr.", desc: "Zum Abschluss reist er ins nahe Lavinium, die legendäre Gründungsstadt des Aeneas.", quote: "Und reiste dort nach Lavinium.", source: "HA, MA 27,4" }
        ];

        const PLINIUS_DATA = [
            { id: 1, name: "Kap Malea", lat: 36.43, lng: 23.20, region: "Ägäis", date: "ca. 111 n. Chr.", desc: "Plinius berichtet Trajan von seiner harten Seereise. Er segelt um Kap Malea und wird durch widrige Winde aufgehalten.", quote: "Melde ich Dir, daß ich mit allen meinen Leuten zu Schiff an Kap Malea vorbei [...] gelangt bin.", source: "Plinius, Epist. X, 15" },
            { id: 2, name: "Ephesus", lat: 37.94, lng: 27.34, region: "Asia", date: "September", desc: "Ankunft in der Metropole Ephesus. Die Hitze macht ihm zu schaffen, weshalb er zwischen Schiff und Wagen wechselt.", quote: "Herr, wenn mir die Seereise bis Ephesus sehr gut bekommen ist...", source: "Plinius, Epist. X, 17a" },
            { id: 3, name: "Pergamum", lat: 39.12, lng: 27.18, region: "Asia", date: "September", desc: "Die Reise im Wagen bei großer Hitze verursacht Fieberanfälle. Plinius muss in Pergamum eine Pause einlegen.", quote: "...habe ich [...] sehr unter der drückenden Hitze gelitten.", source: "Plinius, Epist. X, 17a" },
            { id: 4, name: "Prusa", lat: 40.18, lng: 29.06, region: "Bithynia", date: "17. Sept.", desc: "Plinius trifft in seiner Provinz ein und prüft die Finanzen. Er entdeckt Unregelmäßigkeiten und fordert einen Baumeister an.", quote: "Zur Zeit prüfe ich die Ausgaben, Einnahmen und Außenstände in Prusa.", source: "Plinius, Epist. X, 17a" },
            { id: 5, name: "Nicomedia", lat: 40.76, lng: 29.92, region: "Bithynia", date: "Winter 111/112", desc: "Plinius inspiziert eine gescheiterte Wasserleitung, die Millionen Sesterzen verschlungen hat und dennoch unfertig ist.", quote: "Herr, für eine Wasserleitung haben die Nicomedenser 3.318.000 Sestertien verausgabt...", source: "Plinius, Epist. X, 37" },
            { id: 6, name: "Nicaea", lat: 40.43, lng: 29.72, region: "Bithynia", date: "112 n. Chr.", desc: "In Nicaea findet er ein Theater vor, das sich wegen weichen Bodens senkt und Risse bekommt.", quote: "Herr, das Theater in Nicaea [...] hat [...] mehr als 10 Mill. verschlungen.", source: "Plinius, Epist. X, 39" },
            { id: 7, name: "Claudiopolis", lat: 40.85, lng: 31.15, region: "Bithynia", date: "112 n. Chr.", desc: "Die Bürger bauen ein riesiges Bad in einer sumpfigen Niederung. Plinius fürchtet Geldverschwendung.", quote: "Auch die Claudiopolitaner bauen [...] ein gewaltiges Bad in einer Niederung.", source: "Plinius, Epist. X, 39" },
            { id: 8, name: "Byzantium", lat: 41.00, lng: 28.95, region: "Thracia", date: "112 n. Chr.", desc: "Plinius streicht die Kosten für einen Gesandten, der jährlich nur eine Ehrenadresse nach Rom bringen sollte.", quote: "Als ich in Byzanz die Ausgaben revidierte [...] habe ich es für richtig gehalten, auf den Gesandten zu verzichten.", source: "Plinius, Epist. X, 43" },
            { id: 9, name: "Sinope", lat: 42.02, lng: 35.15, region: "Pontus", date: "112/113 n. Chr.", desc: "Sinope leidet unter Wassermangel. Plinius schlägt ein Aquädukt vor.", quote: "Herr, die Sinopenser leiden Mangel an Wasser.", source: "Plinius, Epist. X, 90" },
            { id: 10, name: "Amisus", lat: 41.28, lng: 36.33, region: "Pontus", date: "112/113 n. Chr.", desc: "Hier verfasst Plinius seinen berühmten Brief über die Christenverhöre.", quote: "Gerichtsverhandlungen gegen Christen habe ich noch nie beigewohnt...", source: "Plinius, Epist. X, 96" }
        ];

        // --- 2. CONFIG & STATE ---
        let map;
        let currentLayers = [];
        let currentPolyline = null;
        let activeRoute = 'marc';

        const CONFIG = {
            marc: {
                color: '#c5a059', // antiquity-gold
                bgClass: 'bg-antiquity-gold',
                textClass: 'text-antiquity-gold',
                borderClass: 'border-antiquity-gold',
                title: 'Iter Marci Aurelii'
            },
            plinius: {
                color: '#4d8076', // antiquity-copper
                bgClass: 'bg-[#4d8076]',
                textClass: 'text-[#4d8076]',
                borderClass: 'border-[#4d8076]',
                title: 'Iter Plinii'
            }
        };

        // --- 3. INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Map
            // Center on Mediterranean, customized tiles
            map = L.map('map', {
                zoomControl: false,
                attributionControl: true
            }).setView([38.0, 24.0], 6);

            // Add Zoom Control top-right
            L.control.zoom({ position: 'topright' }).addTo(map);

            // CartoDB Voyager (lighter, paper-like feel) or Dark Matter?
            // User requested "Classic" view, so a light map fits the parchment theme better.
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            // Add Labels separately to have them on top (optional, improves legibility)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}{r}.png', {
                subdomains: 'abcd',
                maxZoom: 19,
                opacity: 0.6
            }).addTo(map);

            // Init Icons
            lucide.createIcons();

            // Load Default Route
            switchRoute('marc');
        });

        // --- 4. LOGIC ---

        function switchRoute(routeKey) {
            activeRoute = routeKey;
            const data = routeKey === 'marc' ? MARC_AUREL_DATA : PLINIUS_DATA;
            const theme = CONFIG[routeKey];

            // 1. Update UI Buttons
            const btnMarc = document.getElementById('btn-marc');
            const btnPlin = document.getElementById('btn-plinius');

            if (routeKey === 'marc') {
                btnMarc.className = `px-6 py-2 rounded font-heading text-sm tracking-widest transition-all shadow-lg ${CONFIG.marc.bgClass} text-antiquity-dark scale-105`;
                btnPlin.className = `px-6 py-2 rounded font-heading text-sm tracking-widest transition-all text-gray-400 hover:text-antiquity-copper`;
            } else {
                btnMarc.className = `px-6 py-2 rounded font-heading text-sm tracking-widest transition-all text-gray-400 hover:text-antiquity-gold`;
                btnPlin.className = `px-6 py-2 rounded font-heading text-sm tracking-widest transition-all shadow-lg ${CONFIG.plinius.bgClass} text-white scale-105`;
            }

            // 2. Clear Map
            currentLayers.forEach(layer => map.removeLayer(layer));
            currentLayers = [];
            if (currentPolyline) map.removeLayer(currentPolyline);

            // 3. Draw Polyline
            const latlngs = data.map(d => [d.lat, d.lng]);
            currentPolyline = L.polyline(latlngs, {
                color: theme.color,
                weight: 2,
                opacity: 0.6,
                dashArray: '5, 10',
                className: 'animate-pulse' // Subtle pulse
            }).addTo(map);
            
            // 4. Draw Markers
            data.forEach((site, index) => {
                const iconHtml = `
                    <div class="custom-marker" style="
                        background-color: ${theme.color}; 
                        width: 24px; height: 24px;
                        border: 2px solid #fff;">
                        ${index + 1}
                    </div>
                `;
                
                const icon = L.divIcon({
                    html: iconHtml,
                    className: 'bg-transparent',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });

                const marker = L.marker([site.lat, site.lng], { icon: icon }).addTo(map);
                
                // Tooltip on Hover
                marker.bindTooltip(site.name, {
                    permanent: false,
                    direction: 'top',
                    offset: [0, -10],
                    className: 'font-heading text-xs tracking-wider bg-antiquity-base border border-antiquity-gold px-2 py-1 shadow'
                });

                // Click Event
                marker.on('click', () => {
                    updateDetails(site, theme);
                    
                    // Highlight active marker visually (reset others)
                    // (Simple logic: re-render is easiest, but let's just flyTo for now)
                    map.flyTo([site.lat, site.lng], 7, {
                        animate: true,
                        duration: 1.5
                    });
                });

                currentLayers.push(marker);
            });

            // 5. Reset Panel
            document.getElementById('location-details').classList.add('hidden');
            document.getElementById('empty-state').classList.remove('hidden');
            document.getElementById('panel-title').innerText = theme.title;
            document.getElementById('loc-region').innerText = "Wähle eine Station";

            // 6. Fly to bounds
            if (latlngs.length > 0) {
                map.flyToBounds(latlngs, { padding: [50, 50], duration: 2 });
            }
        }

        function updateDetails(site, theme) {
            const details = document.getElementById('location-details');
            const empty = document.getElementById('empty-state');
            
            empty.classList.add('hidden');
            details.classList.remove('hidden');
            
            // Re-trigger animation
            details.classList.remove('animate-fade-in');
            void details.offsetWidth; // trigger reflow
            details.classList.add('animate-fade-in');

            // Content
            document.getElementById('panel-title').innerText = site.name;
            
            const regionEl = document.getElementById('loc-region');
            regionEl.innerText = site.region;
            regionEl.style.color = theme.color;

            document.getElementById('loc-date').innerText = site.date;
            document.getElementById('loc-text').innerText = site.desc;
            document.getElementById('loc-quote').innerText = `"${site.quote}"`;
            
            const sourceEl = document.getElementById('loc-source');
            sourceEl.innerText = site.source;
            sourceEl.style.color = theme.color;

            // Image (Using generic antique keywords + site name for variety)
            const img = document.getElementById('loc-img');
            const keywords = `${site.name},ancient ruins,roman,landscape`;
            img.src = `https://source.unsplash.com/600x400/?${encodeURIComponent(keywords)}`;
            
            // Fallback for Unsplash Source deprecation or issues:
            // Using a reliable static placeholder if unsplash source is flaky, 
            // but the query param method usually works for demos.
            // Alternative: specifically curated images array if you had one.
            img.onerror = function() {
                this.src = 'https://images.unsplash.com/photo-1552832230-c0197dd311b5?auto=format&fit=crop&q=80&w=600'; // Rome fallback
            };
        }

    </script>
</body>
</html>
